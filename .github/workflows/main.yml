name: RDP
on: [workflow_dispatch]

jobs:
  build:
    # Use a Windows runner
    runs-on: windows-latest

    # Permissions are required for OIDC/auth if using the recommended Tailscale setup
    permissions:
      contents: read
      id-token: write # Required for OIDC authentication with Tailscale

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Connect to Tailscale network using the official GitHub Action
      - name: Connect Tailscale
        uses: tailscale/github-action@v4
        with:
          # Use OAuth Client ID and Secret stored as GitHub secrets
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:ci # Replace 'tag:ci' with an existing tag in your Tailscale ACLs

      # This is where you would typically set up RDP on the Windows runner.
      # The GitHub-hosted runners have RDP capabilities, but you need
      # a way to get the credentials and IP address securely.
      # Note: Direct RDP access to GitHub-hosted runners is not officially supported
      # and usually relies on workarounds that are often against GitHub's ToS
      # or involve non-standard tools/scripts like those found on YouTube.

      # A more standard and supported approach is using Tailscale for *deployments*
      # and accessing other machines, not typically the runner itself for interactive RDP.
      # The following steps demonstrate connecting to other machines using Tailscale SSH.

      - name: Run a command on another machine in the Tailnet
        run: |
          # Use Tailscale SSH to connect to a private IP or Magic DNS name
          # You would need to add your SSH public key to the target machine(s)
          # tailscale ssh user@hostname.ts.net "echo 'Hello from GitHub Actions'"
        shell: bash
